<html><head>
<style type="text/css">
td{ vertical-align:top;
 background-color:white;
 white-space:nowrap;
 font-family:lucida console,monospace;
 font-weight:bold; font-size:x-large;}
code{ font-size:large; text-transform:lowercase;}
.t1{ color:#ddaa00;}
.h2{ color:#aa7700; font-style:italic;}
.d2{ color:#ddaa00;}
.t3{ color:#ff0000;}
.t4{ color:#00cc00;}
.h5{ color:#009900; font-style:italic;}
.d5{ color:#00cc00;}
.h6{ color:#009900; font-style:italic;}
.d6{ color:#00cc00;}
.t7{ color:#00cccc;}
.h8{ color:#aa7700; font-style:italic;}
.d8{ color:#ddaa00;}
.t9{ color:#444444;}
.ta{ color:#000000; text-transform:capitalize;}
.tb{ color:#000000; text-transform:uppercase;}
.tc{ color:#ff00ff;}
.dc{ color:#00ff00;}
.hd{ color:#bbbbbb; font-style:italic;}
.te{ color:#0000ff;}
.hf{ color:#777777; font-style:italic;}
.df{ color:#444444;}
</style>
</head><body><table>
<tr>
<td class=cf><br><code class=t9>notes-</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> memory-access words assume that addresses<br>and data are 16-bit parameters with the upper <br>two bits zero and pages are 4-bits with the</code><code class=te><br></code><code class=t9>upper</code><code class=df> 14</code><code class=t9> bits zero. the three memory commands <br>are encoded in the first one or two parameters<br>used, marked with '+' and '-' below.</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t3> &nbsp;ex@</code><code class=t1> a +p</code><code class=t4> w</code><code class=t9> fetch</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t3> &nbsp;ex!</code><code class=t1> w -a -p</code><code class=t9> store</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t3> &nbsp;cx?</code><code class=t1> w2 a +p -w1</code><code class=t4> f</code><code class=t9> comp-and-exch</code><code class=te><br></code><code class=t9>the three words access all available memory</code><code class=te><br></code><code class=t9>with the 20-bit p.a address.</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> cx?</code><code class=t9> compares value at p.a to w1. if same,<br>writes w2 to p.a and returns true. otherwise, <br>only returns false.</code><code class=t4> x@</code><code class=t9> and</code><code class=t4> x!</code><code class=t9> are 16-bit addr.<br>versions to access the lowest 64k of available</code><code class=te><br></code><code class=t9>memory.</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> n2x nqx</code><code class=t9> and</code><code class=t4> test</code><code class=t9> were used in development<br>and may be overwritten by user code.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
<td>&nbsp;&nbsp;</td>
<td class=cf>728 list
<br><code class=t9>sram.16 user node 106, 108, or 207.</code><code class=h8> 39</code><code class=t1> org</code><code class=t3><br>x!</code><code class=t9> wa-</code><code class=hd> 039</code><code class=t4> dup dup or</code><code class=t3><br>ex!</code><code class=t9> wap-</code><code class=hd> 03A</code><code class=t4> - !b - !b !b ;</code><code class=t3><br>x@</code><code class=t9> a-w</code><code class=hd> 03C</code><code class=t4> dup dup or</code><code class=t3><br>ex@</code><code class=t9> ap-w</code><code class=hd> 03D</code><code class=t4> !b !b @b ;</code><code class=t3><br>cx?</code><code class=t9> wapw-f</code><code class=hd> 03E</code><code class=t4> - !b !b !b !b @b ;</code><code class=te><br><br></code><code class=t3>args</code><code class=t9> wa-waxa</code><code class=hd> 040</code><code class=t4> over over or over ;</code><code class=t3><br>n2x</code><code class=t9> wapn-wa'p</code><code class=hd> 042</code><code class=t4> for push args</code><code class=te><br></code><code class=t4>pop dup push ex!</code><code class=d6> 1</code><code class=t4> . + pop next ;</code><code class=t3><br>nqx</code><code class=t9> wapn-wa'xpn'/wa'ppp</code><code class=hd> 04A</code><code class=t4> for push args</code><code class=te><br></code><code class=t4>pop dup push ex@ or if pop pop ; then</code><code class=te><br></code><code class=t4>drop</code><code class=d6> 1</code><code class=t4> . + pop next dup dup ;</code><code class=te><br><br></code><code class=hd>054</code><code class=h8> 20</code><code class=t1> org here boot</code><code class=t3><br>start</code><code class=hd> 020</code><code class=t9> right</code><code class=t4> left</code><code class=t9> up</code><code class=t4> b! ;</code><code class=t9> softsim fall-thru</code><code class=t3><br>test</code><code class=hd> 022</code><code class=t9> loop for no-testbed softsim</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=h6> ABCD 1234 0</code><code class=t4> ex!</code><code class=h6> 1111 F</code><code class=t4> ex@ test ;</code><code class=hd> 02C&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
</tr>
<tr>
<td class=cf><br><code class=t9>notes-</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> the e4th stack node must abut the memory <br>driver to have fast bidirectional access to</code><code class=te><br></code><code class=t9>external memory.</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> the code must not overwrite the sram user<br>code compiled from block</code><code class=df> 728</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> psht</code><code class=t9> is placed so it falls into</code><code class=t4> x!</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> naming conventions</code><code class=te><br></code><code class=t3>'name</code><code class=t9> for</code><code class=t4> code.e4</code><code class=t9> words</code><code class=te><br></code><code class=t3>*name</code><code class=t9> for</code><code class=t4> usercode.e4</code><code class=t9> optimizations</code><code class=te><br></code><code class=t3>.name</code><code class=t9> for</code><code class=t4> usercode.e4</code><code class=t9> additions</code><code class=t3><br>others</code><code class=t9> are internal words</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> e4th's external data stack grows down</code><code class=te><br></code><code class=t9>with pre-dec writes and post-inc reads.</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> the stack-node's stack keeps the e4th</code><code class=te><br></code><code class=t1>stack pointer</code><code class=t9> and cached</code><code class=t1> s</code><code class=t9> and</code><code class=t1> t</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> 16-bit words are</code><code class=t1> 00.nnnn.nnnn.nnnn.nnnn&nbsp;&nbsp;<br></code><br></td>
<td>&nbsp;&nbsp;</td>
<td class=cf>740 list
<br><code class=t9>e4.16 stack 1of2</code><code class=te><br></code><code class=t1>' x@ org</code><code class=t3> &nbsp;'au@</code><code class=t9> a-w</code><code class=hd> 03C</code><code class=h8> 0</code><code class=t1> org</code><code class=t3><br>'1+</code><code class=t9> w-w</code><code class=hd> 000</code><code class=d6> 1</code><code class=t4> . +</code><code class=te></code><code class=t3> &nbsp;mask</code><code class=t9> w-w</code><code class=hd> 002</code><code class=h6> FFFF</code><code class=t4> and ;</code><code class=t3><br>*2/</code><code class=t9> w-w</code><code class=hd> 004</code><code class=t4> 2* 2* 2/ 2/ 2/ mask ;</code><code class=t3><br>popt</code><code class=t9> p-pt</code><code class=hd> 006</code><code class=t4> dup '1+ over x@ ;</code><code class=t3><br>'au!</code><code class=t9> pst-p43</code><code class=hd> 008</code><code class=t4> x!</code><code class=t3><br>popst</code><code class=t9> p-pst</code><code class=hd> 009</code><code class=t4> popt</code><code class=t3><br>pops</code><code class=t9> pt-pst</code><code class=hd> 00A</code><code class=t4> push popt pop ;</code><code class=t3><br>pop43</code><code class=t9> pst-p43st</code><code class=hd> 00C</code><code class=t4> push push popst pop pop ;</code><code class=t3><br>'1-</code><code class=t9> w-w</code><code class=hd> 00E</code><code class=d6> -1</code><code class=t4> . + mask ;</code><code class=hd> 011</code><code class=t1> here</code><code class=h8> 37</code><code class=t1> org</code><code class=t3><br>psht</code><code class=t9> pt-p</code><code class=hd> 037</code><code class=t4> push '1- pop over</code><code class=t9> x! ;</code><code class=hd> 039</code><code class=t9> *</code><code class=t1> org</code><code class=t3><br>pshs</code><code class=t9> pst-pt</code><code class=hd> 011</code><code class=t4> push psht pop ;</code><code class=t3><br>pshw</code><code class=t9> pstw-ptw</code><code class=hd> 013</code><code class=t4> push pshs pop ;</code><code class=t3><br>'sp@</code><code class=t9> pst-ptp</code><code class=hd> 015</code><code class=t4> pshs psht dup pops ;</code><code class=t3><br>'sp!</code><code class=t9> ptp-pst</code><code class=hd> 018</code><code class=t4> pshs popst ;</code><code class=t3><br>'drop</code><code class=t9> pst-p3s</code><code class=hd> 01A</code><code class=t4> drop pops ;</code><code class=t3><br>'over</code><code class=t9> pst-pts</code><code class=hd> 01B</code><code class=t4> over pshw ;</code><code class=te><br><br></code><code class=t3>.ex!</code><code class=t9> pst-p54</code><code class=hd> 01C</code><code class=t4> pop43 ex! pops ;</code><code class=t3><br>.ex@</code><code class=t9> pst-p3w</code><code class=hd> 01F</code><code class=t4> ex@ pops ;</code><code class=t3><br>.cx?</code><code class=t9> pst-p5f</code><code class=hd> 021</code><code class=t4> pop43 cx? pops ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
</tr>
<tr>
<td class=cf><br><code class=t9>notes-</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> the initial sp is reset by</code><code class=t1> cold</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> code must fit before block 740's</code><code class=t4> psht</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> some optimizations are commented out</code><code class=te><br></code><code class=t9>so as not to lose the code for use later when/<br>if some code is put in rom.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
<td>&nbsp;&nbsp;</td>
<td class=cf>742 list
<br><code class=t9>e4.16 stack 2of2</code><code class=t3><br>*2*</code><code class=t9> w-w</code><code class=hd> 024</code><code class=t4> 2* mask ;</code><code class=t3><br>'or</code><code class=t9> pst-p3w</code><code class=hd> 025</code><code class=t4> over - and</code><code class=t3><br>'xor</code><code class=t9> pst-p3w</code><code class=hd> 026</code><code class=t4> or pops ;</code><code class=t3><br>'and</code><code class=t9> pst-p3w</code><code class=hd> 027</code><code class=t4> and pops ;</code><code class=t3><br>*neg</code><code class=t9> n-n</code><code class=hd> 028</code><code class=t9> '1-</code><code class=t3><br>*inv</code><code class=t9> w-w</code><code class=hd> 028</code><code class=t9> begin</code><code class=t4> - mask ;</code><code class=t3><br>*zeq</code><code class=t9> w-f</code><code class=hd> 029</code><code class=t9> until</code><code class=t4> begin dup or ;</code><code class=t3><br>'zlt</code><code class=t9> n-f</code><code class=hd> 02A</code><code class=t4> 2* 2* -until dup or *inv ;</code><code class=t3><br>'um+</code><code class=t9> uu-uc</code><code class=hd> 02C</code><code class=t4> +</code><code class=h6> 10000</code><code class=t4> over and if or</code><code class=d6> 1</code><code class=t4> ;</code><code class=t3><br>'nop</code><code class=hd> 031</code><code class=t4> then</code><code class=t9> begin</code><code class=t4> ;</code><code class=t3><br>*qdup</code><code class=t9> pst-pst/ptt</code><code class=hd> 032</code><code class=t9> until</code><code class=t3><br>'dup</code><code class=t9> pst-ptt</code><code class=hd> 032</code><code class=t4> dup pshw ;</code><code class=t3><br>'swap</code><code class=t9> st-ts</code><code class=hd> 033</code><code class=t4> over push push drop pop pop ;</code><code class=t3><br>*-</code><code class=t9> pst-p3n</code><code class=hd> 035</code><code class=t9> *neg</code><code class=t3><br>*+</code><code class=t9> pst-p3n</code><code class=hd> 035</code><code class=t4> + mask pops ;</code><code class=te><br></code><code class=hd>037</code><code class=t1> exit</code><code class=t9> start is run in ide</code><code class=t3><br>start</code><code class=t4> right b!</code><code class=d6> 0</code><code class=t4> dup dup</code><code class=t9> sp.s.t</code><code class=t4> --l- ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
</tr>
<tr>
<td class=cf><br><code class=t9>notes-</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> bpopw</code><code class=t9> and</code><code class=t4> bpshw</code><code class=t1> orgs</code><code class=t9> must match bitsy</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> tx?</code><code class=t1> *-*</code><code class=t9> is used to send characters and to<br>set status values, controlled by the sign bit.<br>all data are 16-bit values.</code><code class=te><br><br></code><code class=t4>tx? status values</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t1> in</code><code class=t9> 0/autobaud, +n/bit delay</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t1> out</code><code class=t9> +n/bit delay</code><code class=te><br></code><code class=t4>tx? characters</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t1> in</code><code class=t9> inverted character -c</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t1> out</code><code class=df> 0</code><code class=t9> if sent, -c if not sent</code><code class=te><br><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> user code must initialize</code><code class=t4> a</code><code class=t9> register with<br>port address of terminal node.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
<td>&nbsp;&nbsp;</td>
<td class=cf>738 list
<br><code class=t9>serial.16 user</code><code class=h8> 3C</code><code class=t1> org</code><code class=t3><br>rx?</code><code class=t9> -*</code><code class=hd> 03C</code><code class=t4> @ ;</code><code class=t9> * is</code><code class=df> 0</code><code class=t9> or -c</code><code class=t3><br>tx?</code><code class=t9> *-*</code><code class=hd> 03D</code><code class=t4> ! @ ;</code><code class=t9> * see shadow</code><code class=te><br><br></code><code class=hd>03E</code><code class=h8> 20</code><code class=t1> org</code><code class=t9> programmed with some abandon</code><code class=t3><br>start</code><code class=t4> right a! ;</code><code class=t9> serial test code</code><code class=t3><br>key</code><code class=t9> -c</code><code class=hd> 022</code><code class=t4> dup begin drop rx? until</code><code class=h6> FFFF</code><code class=t4> or ;</code><code class=t3><br>emit</code><code class=t9> c-</code><code class=hd> 027</code><code class=t4> begin - tx? - -until drop ;</code><code class=t3><br>echo</code><code class=hd> 02A</code><code class=t4> key dup emit</code><code class=h6> 20</code><code class=t4> or if echo ; then ;</code><code class=t3><br>send</code><code class=t9> c-c</code><code class=hd> 030</code><code class=t4> dup emit send ;</code><code class=t3><br>test</code><code class=t9> c-cf</code><code class=hd> 032</code><code class=t4> dup emit key over or ;</code><code class=t3><br>testing</code><code class=t9> cn-c/ccn</code><code class=hd> 035</code><code class=t4> for test</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> if over or pop ; then drop next ;</code><code class=hd> 03B&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
</tr>
<tr>
<td class=cf><br><code class=t9>notes-</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> the bitsy node keeps the return-stack</code><code class=te><br></code><code class=t9>pointer and the interpreter pointer on its</code><code class=te><br></code><code class=t9>stack.</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> memory access gets done only through the <br>stack node.</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> btc@</code><code class=t9> is included only to provide a unique<br>marker for the stack node's ide single-stepper<br>routine, incurring some overhead on every xt.&nbsp;<br></code><br></td>
<td>&nbsp;&nbsp;</td>
<td class=cf>744 list
<br><code class=t9>e4.16 bitsy 1of2</code><code class=h8> 0</code><code class=t1> org</code><code class=t3><br>rp--</code><code class=t9> r-r</code><code class=hd> 000</code><code class=d6> -1</code><code class=t3><br>+mask</code><code class=t9> nn-w</code><code class=hd> 002</code><code class=t4> +</code><code class=h6> FFFF</code><code class=t4> and ;</code><code class=t3><br>btc@</code><code class=t9> ii-ix</code><code class=hd> 004</code><code class=t4> @p !b !b dup</code><code class=t9> /</code><code class=t4> . @p drop .</code><code class=t9> /</code><code class=t3><br>'ip@</code><code class=te></code><code class=t3> &nbsp;bx@</code><code class=t9> a-w</code><code class=hd> 006</code><code class=t4> @p !b !b .</code><code class=t9> /</code><code class=t4> @p x@</code><code class=t9> /</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> @p !b @b ;</code><code class=t9> /</code><code class=t4> . . . !p</code><code class=t9> /</code><code class=t3><br>'rp@</code><code class=t9> ri-ri</code><code class=hd> 00A</code><code class=t4> over rp--</code><code class=t3><br>bpshw</code><code class=t9> w-</code><code class=hd> 00B</code><code class=t4> @p !b !b ;</code><code class=t9> /</code><code class=t4> @p pshw</code><code class=t9> /</code><code class=te><br><br></code><code class=t3>*con</code><code class=t9> ri-ri</code><code class=hd> 00D</code><code class=t4> 'ip@</code><code class=t3><br>*var</code><code class=t9> ri-ri</code><code class=hd> 00E</code><code class=t4> dup bpshw</code><code class=t3><br>'exit</code><code class=t9> ri-ri</code><code class=hd> 00F</code><code class=t4> drop rp-- dup bx@ ;</code><code class=te><br><br></code><code class=t3>'r@</code><code class=t9> ri-ri</code><code class=hd> 011</code><code class=t4> over rp--</code><code class=t3><br>@2tos</code><code class=t9> a-</code><code class=hd> 012</code><code class=t4> bx@ bpshw ;</code><code class=t3><br>'rfrom</code><code class=t9> ri-*ri</code><code class=hd> 014</code><code class=t4> over rp-- over over @2tos ;</code><code class=t3><br>bpopw</code><code class=t9> -w</code><code class=hd> 016</code><code class=t4> @p !b @b ;</code><code class=t9> /</code><code class=t4> !p pops</code><code class=t9> /</code><code class=t3><br>bx!++</code><code class=t9> aw-a</code><code class=hd> 018</code><code class=t4> @p !b !b dup</code><code class=t9> /</code><code class=t4> . . . @p</code><code class=t9> /</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> @p !b !b .</code><code class=t9> /</code><code class=t4> @p x!</code><code class=t9> /</code><code class=t3><br>rp++</code><code class=te></code><code class=t3> &nbsp;ip++</code><code class=t9> a-a</code><code class=hd> 01C</code><code class=d6> 1</code><code class=t4> +mask ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
</tr>
<tr>
<td class=cf><br><code class=t9>notes-</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> the bit-threaded code technique confines <br>execution to the</code><code class=t4> bitsy</code><code class=t9> loop and a small number<br>of code words. it uses one or more bits of the<br>execution token to select the class-</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t1> 00.100x.xxaa.aaaa.aaaa</code><code class=t9> code.s-xt</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t1> 00.110x.xxaa.aaaa.aaaa</code><code class=t9> code.b-xt</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t1> 00.0aaa.aaaa.aaaa.aaaa</code><code class=t9> list-xt</code><code class=te><br></code><code class=t9>-and process the token. code tokens are called<br>while list tokens are interpreted.</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> the ide can single-step the bitsy node by<br>calling</code><code class=t4> step</code><code class=t9> instead of executing</code><code class=t4> bitsy.</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> the terminal i/o words</code><code class=t4> rx?</code><code class=t9> and</code><code class=t4> tx?</code><code class=t9> are</code><code class=te><br></code><code class=t9>here because they don't fit in the stack node.</code><code class=t1><br>note</code><code class=t9> that they must be in the same location</code><code class=te><br></code><code class=t9>here as they are in block</code><code class=df> 738</code><code class=t9> for the ide test<br>words to work.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
<td>&nbsp;&nbsp;</td>
<td class=cf>746 list
<br><code class=t9>e4.16 bitsy 2of2</code><code class=t3><br>'exe</code><code class=t9> ri-ri</code><code class=hd> 01E</code><code class=t4> bpopw</code><code class=t3><br>xxt</code><code class=t9> rix-ri</code><code class=hd> 01F</code><code class=t4> 2* 2* -if</code><code class=te><br></code><code class=t9>code rix-ri</code><code class=hd> 020</code><code class=t4> 2* 2/ 2/ 2/ -if</code><code class=te><br></code><code class=t9>code.b rix-ri</code><code class=hd> 022</code><code class=t4> push ;</code><code class=te><br></code><code class=t9>code.s rix-ri</code><code class=hd> 023</code><code class=t4> then</code><code class=h6> 12000</code><code class=t4> or !b ;</code><code class=te><br></code><code class=t9>list rix-ri</code><code class=hd> 025</code><code class=t4> then push bx!++ pop 2/ ;</code><code class=t3><br>step</code><code class=t9> ri-ri</code><code class=hd> 027</code><code class=t4> dup btc@ push ip++ pop xxt ;</code><code class=t3><br>bitsy</code><code class=t9> ri</code><code class=hd> 02A</code><code class=t4> step bitsy ;</code><code class=te><br><br></code><code class=t3>'tor</code><code class=t9> ri-ri</code><code class=hd> 02C</code><code class=t4> push bpopw bx!++ pop ;</code><code class=t3><br>'rp!</code><code class=t9> ri-*ri</code><code class=hd> 02F</code><code class=t4> push bpopw rp++ pop ;</code><code class=t3><br>*lit</code><code class=t9> ri-ri</code><code class=hd> 032</code><code class=t4> dup @2tos ip++ ;</code><code class=t3><br>'if</code><code class=t9> ri-ri</code><code class=hd> 034</code><code class=t4> bpopw if drop ip++ ;</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> then drop 'ip@ ;</code><code class=te><br></code><code class=hd>038</code><code class=h8> 3C</code><code class=t1> org</code><code class=t3><br>.rx?</code><code class=hd> 03C</code><code class=t4> @ bpshw ;</code><code class=t3><br>.tx?</code><code class=hd> 03D</code><code class=t4> @p !b @b .</code><code class=t9> /</code><code class=t4> !p . . @p</code><code class=t9> /</code><code class=t4> ! @ !b ;</code><code class=te><br><br></code><code class=hd>040</code><code class=t1> exit</code><code class=t9> start is run in ide</code><code class=t3><br>start</code><code class=t4> right</code><code class=t9> terminal</code><code class=t4> a! left</code><code class=t9> stack</code><code class=t4> b!</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=h6> FFE0 5</code><code class=t9> rp.ip</code><code class=t4> bitsy ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
</tr>
<tr>
<td class=cf><br><code class=t9>this tester code assumes the ide is hooked to <br>one of the sram user nodes. it copies the file</code><code class=t4><br>eforth.bin</code><code class=t9> into ram starting at</code><code class=t4> e4*</code><code class=t9> . the</code><code class=te><br></code><code class=t9>first cell of the file contains the length of <br>the file in cells.</code><code class=te><br><br></code><code class=t3>e4*</code><code class=t9> constant eforth base address</code><code class=t3><br>fh</code><code class=t9> is file handle used locally.</code><code class=t3><br>e4nam</code><code class=t9> is name of file</code><code class=t3><br>e4buf</code><code class=t9> buffer for reading the file.</code><code class=t3><br>+e4th</code><code class=t9> returns nz indicator if good file open.</code><code class=t3><br>-e4th</code><code class=t9> closes the file.</code><code class=t3><br>!img</code><code class=t9> stores</code><code class=t1> n</code><code class=t9> cells of image in</code><code class=t1> e4buf</code><code class=t9> to memor<br>y at</code><code class=t1> e4*</code><code class=t9> .</code><code class=t3><br>!e4th</code><code class=t9> does the whole operation.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
<td>&nbsp;&nbsp;</td>
<td class=cf>762 list
<br><code class=t9>eforth.bin file copy to sram</code><code class=tc> fh</code><code class=dc> 0</code><code class=t3><br>e4*</code><code class=t9> -a</code><code class=h8> 0</code><code class=hf> 8000</code><code class=t4> ;</code><code class=t9> eforth base address</code><code class=t3><br>'cold</code><code class=t9> -a</code><code class=h8> 5</code><code class=t4> ;</code><code class=t9> eforth cold-start vector address</code><code class=t3><br>e4nam</code><code class=t9> -a</code><code class=t4> align create</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t9> efor</code><code class=h2> 726F6665</code><code class=t1> ,</code><code class=t9> th.b</code><code class=h2> 622E6874</code><code class=t1> ,</code><code class=t9> in</code><code class=h8> 6E69</code><code class=t1> ,</code><code class=t3><br>e4buf</code><code class=t9> -a</code><code class=t4> align create</code><code class=d8> 32768</code><code class=t1> rez</code><code class=te><br><br></code><code class=t3>+e4th</code><code class=t9> -i</code><code class=t4> e4nam r/w fopen if</code><code class=t1> fh</code><code class=t4> ! ; then drop ;</code><code class=t3><br>-e4th</code><code class=t1> fh</code><code class=t4> @</code><code class=d8> 0</code><code class=t4> + if fclose</code><code class=d6> 0</code><code class=t4> then</code><code class=t1> fh</code><code class=t4> ! ;</code><code class=t3><br>!img</code><code class=t9> n</code><code class=t4> push</code><code class=t1> e4buf</code><code class=t4> e4* begin over @ over</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> sm s1+ s1+ next drop drop ;</code><code class=t3><br>!e4th</code><code class=t4> +e4th if</code><code class=t1> e4buf a-b</code><code class=t4> dup</code><code class=d6> 4</code><code class=t1> fh</code><code class=t4> @ frd</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> +</code><code class=t1> e4buf</code><code class=t4> @</code><code class=t9> here</code><code class=t1> e4* -</code><code class=t4> + a-b</code><code class=t1> fh</code><code class=t4> @ frd</code><code class=te><br>&nbsp;&nbsp;&nbsp;&nbsp;</code><code class=t4> -e4th b-a</code><code class=d8> 1</code><code class=t4> + !img then ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
</tr>
<tr>
<td class=cf><br><code class=t9>the stack single-stepper interprets the code.s<br>calls and memory requests from bitsy, stopping<br>only when an xt is being fetched. any you can <br>do anything between steps. the e4th data-stack<br>pointer, s, and t are on the node stack.</code><code class=te><br><br></code><code class=t3>axt</code><code class=t9> stop for all xt's</code><code class=t3><br>lxt</code><code class=t9> stop only at list xt's</code><code class=te><br><br></code><code class=t3>s</code><code class=t9> process requests up to next xt</code><code class=te><br><br></code><code class=t3>bf</code><code class=t9> send</code><code class=t1> ip</code><code class=t9> to stack node as each xt is fetched</code><code class=t3><br>xf</code><code class=t9> fetch from ip or rp address</code><code class=t3><br>ds</code><code class=t9> push e4th data stack, spilling to memory</code><code class=t3><br>df</code><code class=t9> pop e4th data stack, refilling from memory</code><code class=t3><br>xs</code><code class=t9> push word onto return stack</code><code class=t3><br>xx</code><code class=t9> code.s word execution&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
<td>&nbsp;&nbsp;</td>
<td class=cf>768 list
<br><code class=t9>eforth stack node stepper</code><code class=tc> xt?</code><code class=dc> 0</code><code class=t3><br>axt</code><code class=h6> 0</code><code class=t1> xt?</code><code class=t4> ! ;</code><code class=te></code><code class=t3> &nbsp;lxt</code><code class=h6> 8000</code><code class=t1> xt?</code><code class=t4> ! ;</code><code class=t1> axt</code><code class=t3><br>iof</code><code class=t9> -w</code><code class=t1> io</code><code class=t4> r@</code><code class=d6> 8</code><code class=t4> rsh ;</code><code class=t3><br>lf</code><code class=t9> -w</code><code class=t1> left</code><code class=t4> r@ ;</code><code class=te></code><code class=t3> &nbsp;ls</code><code class=t9> w</code><code class=t1> left</code><code class=t4> r! ;</code><code class=te><br><br></code><code class=t3>bf</code><code class=t9> 2ddea</code><code class=t4> c lf dup fm dup</code><code class=t1> xt?</code><code class=t4> @ and drop ;</code><code class=t3><br>xf</code><code class=t9> 563c</code><code class=t4> drop lf lf drop fm ls lf ;</code><code class=t3><br>ds</code><code class=df> 5613</code><code class=t4> drop lf lit'</code><code class=h8> 13</code><code class=t9> pshw</code><code class=t4> call upd lf ;</code><code class=t3><br>df</code><code class=t9> d60a</code><code class=t4> drop get ls</code><code class=h8> A</code><code class=t9> pops</code><code class=t4> call upd lf ;</code><code class=t3><br>xs</code><code class=t9> 2c9b7</code><code class=t4> drop lf lf drop lf sm lf ;</code><code class=t3><br>xx</code><code class=t9> 12xxx</code><code class=t4> rins upd lf ;</code><code class=te><br><br></code><code class=t3>eq</code><code class=t9> nx-n</code><code class=t4> over or if dup or drop ; then + ;</code><code class=t3><br>s</code><code class=t9> n-in</code><code class=t4> lf</code><code class=te></code><code class=t3> &nbsp;step</code><code class=te><br></code><code class=h6>2DDEA</code><code class=t4> eq if bf if s ; then ; then</code><code class=te><br></code><code class=h6>563C</code><code class=t4> eq if xf step ; then</code><code class=te><br></code><code class=h6>5613</code><code class=t4> eq if ds step ; then</code><code class=te><br></code><code class=h6>D60A</code><code class=t4> eq if df step ; then</code><code class=te><br></code><code class=h6>2C9B7</code><code class=t4> eq if xs step ; then</code><code class=te><br></code><code class=t9>12xxx</code><code class=t4> xx step ;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br></code><br></td>
</tr>
</table></body></html>
